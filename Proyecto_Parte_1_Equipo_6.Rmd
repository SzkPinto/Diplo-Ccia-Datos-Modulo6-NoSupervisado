---
title: "Proyecto Modulo 6, parte 1"
author: "Equipo 6"
date: "2025-08-10"
output:
  html_document:
    toc: true
    toc_float: true
    theme: readable
    highlight: tango
    df_print: paged
header-includes: \usepackage[spanish]{babel}
---

Integrantes:

+ Morales González Susan  
+ Pinto González Reyna Suzuky  
+ Reyes Román Eduardo  
+ Ruiz Jiménez Reynaldo David  
+ Vital Arana José Andrés de Jesús  
+ Zetina Rosas Enya  

# Métodos de Reducción de información

## 1. Introducción
El creciente aumento en la cantidad de datos disponibles exige la optimización de los procesos de análisis, con el fin de reducir el consumo de tiempo, recursos computacionales y costos asociados. En este contexto, las técnicas de reducción de componentes representan una herramienta valiosa, ya que permiten simplificar la complejidad de la información al identificar y conservar las dimensiones más relevantes. De esta manera, se facilita la interpretación de los patrones subyacentes, se mejora la eficiencia de los modelos predictivos y se potencia la toma de decisiones fundamentadas.

## 2. Objetivo
En este contexto, el presente proyecto tiene como objetivo principal aplicar tres técnicas de reducción de componentes —PCA, UMAP y t-SNE— sobre una misma base de datos, con el propósito de evaluar si es posible simplificar la información original sin perder los patrones más relevantes del conjunto de datos.

## 3. Contexto de la información

Nombre de la base de datos: Sleep_health_and_lifestyle.csv

El conjunto de datos es un compendio de parámetros asociados con la calidad del sueño y estilo de vida de 400 personas. Consta por tanto de 400 filas y 13 columnas, representando estas últimas las variables a reducir. Partimos de un dataset de 13 componenentes, incluyendo la variable clasificatoria que en este caso en particular es "Sleep.Disorder" o Transtorno del sueño.

### Descripción de las variables

- ID de Persona: Un identificador para cada individuo.
- Género (Gender): El género de la persona (Hombre/Mujer).
- Edad (Age): La edad de la persona en años.
- Ocupación (Ocupation): La ocupación o profesión de la persona.
- Duración del Sueño (Sleep Duration-horas): El número de horas que la persona duerme al día.
- Calidad del Sueño (Quality of Sleep- escala: 1-10): Una calificación subjetiva de la calidad del sueño, del 1 al 10.
- Nivel de Actividad Física (Physical Activity Level- minutos/día): El número de minutos que la persona realiza actividad física diariamente.
- Nivel de Estrés (Stress Level- escala: 1-10): Una calificación subjetiva del nivel de estrés que experimenta la persona, del 1 al 10.
- Categoría de IMC (BMI Category): La categoría de índice de masa corporal (IMC) de la persona (p. ej., Bajo Peso, Normal, Sobrepeso).
- Presión Arterial (Blood Pressure- Sistólica/Diastólica): La medición de la presión arterial de la persona, indicada como presión sistólica sobre presión diastólica. Frecuencia cardíaca (lpm): Frecuencia cardíaca en reposo de la persona    en latidos por minuto.
- Frecuencia cardiaca (Heart rate- lpm): número de veces que el corazón late por minuto.
- Pasos diarios (Daily Steps): Número de pasos que da la persona al día.
- Trastorno del sueño (Sleep Disorder): Presencia o ausencia de un trastorno del sueño en la persona (ninguno, insomnio, apnea del sueño).

* Nota: El análisis utiliza los nombres en inglés.

### Details about Sleep Disorder Column:

None: El individuo no presenta ningún trastorno específico del sueño.
Insomnia: El individuo experimenta dificultad para conciliar o mantener el sueño, lo que conduce a un descanso inadecuado o de mala calidad.
Sleep Apnea: El individuo sufre pausas en la respiración durante el sueño, lo que provoca patrones de sueño interrumpidos y posibles riesgos para la salud.


## 4. Desarrollo de Técnico

Activamos librerías
```{r, warning=FALSE}
source('R-libraries-ICdD.r')
```

Importamos la información
```{r}
df<- read_csv("Sleep_health_and_lifestyle.csv") %>% data.frame()
```
### 4.1 Análisis Exploratorio

```{r}
df |> dim()
```

Si bien la documentación de la base de datos (BDD) menciona 400 observaciones, el documento tiene 374 y, 12 variables en lugar de 400 registros y 13 columnas, la adicional es el ID

```{r}
df |>head(10)
```

La variable Blood Preassure hay que ajustarla porque es una medida cuantitativa que se cargó como carácter. Hagamos la separación de los registros como Sistólica y Diastólica para incluirla de manera adecuada

```{r}
df <- df %>%
  separate(Blood.Pressure, into = c("sistolica_bp", "diastolica_bp"), sep = "/", convert = TRUE)
df |> head(10)
```

### Composición de la tabla de datos

```{r}
df |> vis_dat()
```

No se detectaron datos pérdidos, por lo que en este sentido no hace falta pre procesamiento de datos adicional a las variables categoricas

Se encontraron cinco columnas de tipo caracter, por lo que no es posible aplicar de manera directa la matriz de correlación y en consecuncia PCA, por lo que debemos pasar por un pre procesamiento de datos. En caso especial, la variable "Blood Pressure" es continua pero se clasifica como caracter, por lo que debemos separarla en dos columnas numéricas: sistólica y diastólica.

Como se mencionó anteriormente tenemos a la variable "Sleep Disorder" como la variable de clasificación o respuesta de acuerdo al objetivo de la información.

```{r}
df |> dlookr::diagnose()
```




```{r}
df |> skimr::skim() |> skimr::yank("numeric")
```



```{r}
df |> plot_num()
```

```{r}
df |> skimr::skim() |> skimr::yank("character")
```

```{r}
df |> freq()
```


```{r}
df1 <- df |> dplyr::select(where(is.numeric)) %>% mutate(df$Sleep.Disorder)
colnames(df1)=c("Age","Sleep.Duration","Quality.of.Sleep","Physical.Activity.Level","Stress.Level","sistolica_bp","diastolica_bp","Heart.Rate","Daily.Steps","Sleep.Disorder")
```

Cambio a data set Long

```{r}
df_long <- df1 %>% 
    pivot_longer(!Sleep.Disorder, names_to = "predictores", values_to = "values")
df_long |> head()
```
Comparación para las variables numéricas versus la de clasificacion o respuesta

```{r}

df_long %>% 
  ggplot(mapping = aes(x = Sleep.Disorder, y = values, fill = predictores)) +
  geom_boxplot() + 
  facet_wrap(~ predictores, scales = "free", ncol = 4) +
  scale_color_viridis_d(option = "plasma", end = .7) +
  theme(legend.position = "none") +
  labs(title = "Comparación vía box-plot")

```

```{r}
df_long |> ggplot(mapping = aes(values, fill = Sleep.Disorder)) +
  geom_histogram(color = "white") +
  facet_wrap(~predictores, scales = "free", ncol= 4) +
  scale_color_viridis_d(option = "plasma", end = .7) +
  labs(title = "Variables Distribution") +
  theme_light()+
  labs(title = "Comparación vía histograma")
```


```{r}
df_long |> ggplot(mapping = aes(values, fill = Sleep.Disorder)) +
  geom_density(color = "white") +
  facet_wrap(~predictores, scales = "free", ncol= 4) +
  scale_color_viridis_d(option = "plasma", end = .7) +
  labs(title = "Variables Distribution") +
  theme_light()+
  labs(title = "Comparación a través de densidad")

```

```{r}
ggpairs(df1, mapping = aes(color = Sleep.Disorder),columns = seq(1,8),progress = FALSE)
```

Se confirma enseguida si existe una estructura de Asociación entre las variables

1. Valores de la Matriz de correlación (Correlación de Pearson)
```{r}
cor_data<-cor(df1[,-10])

cor1_data<-cor(df1[,-10],method="spearman")

ggcorrplot::ggcorrplot(corr = cor1_data,
                       type = "lower", 
                       show.diag = TRUE,
                       lab = TRUE, 
                       lab_size = 3)
```
## Interpretación de la Matriz de Correlación

A partir de la matriz de correlación (Spearman), se observan los siguientes hallazgos clave:

- **Presión arterial sistólica y diastólica (r = 0.98)**  
  Existe una correlación positiva muy fuerte, lo que indica que ambas medidas son prácticamente redundantes.

- **Duración del sueño y calidad del sueño (r = 0.89)**  
  A mayor número de horas de sueño, se reporta una mejor calidad del mismo.

- **Calidad del sueño y nivel de estrés (r = -0.91)**  
  Correlación negativa muy fuerte: cuando la calidad del sueño es alta, los niveles de estrés tienden a disminuir.

- **Nivel de actividad física y pasos diarios (r = 0.79)**  
  Una relación positiva clara: mayor número de pasos diarios implica un nivel de actividad física más alto.

- **Calidad del sueño y frecuencia cardíaca (r = -0.73)**  
  Mejor calidad de sueño se asocia con una frecuencia cardíaca más baja.


- **Correlaciones débiles o nulas**  
  Por ejemplo, entre **nivel de estrés y frecuencia cardíaca (r = 0.08)**, no se evidencia una relación clara.

---

En resumen, los resultados confirman relaciones esperadas entre variables de salud:  
- El sueño influye directamente en el estrés y la frecuencia cardíaca.  
- La actividad física está bien reflejada en los pasos diarios.  


2. Determinante de la Matriz
```{r}
det(cor1_data)
```
## Interpretación : 
Alta multicolinealidad

Las variables están fuertemente correlacionadas entre sí.

Ejemplos claros: presión sistólica ↔ presión diastólica (0.98), calidad del sueño ↔ duración del sueño (0.89).

3. Indicador KMO (cercano a 1, relación fuerte entre las variables)

```{r}
psych::KMO(cor1_data)
```


4. Prueba que la Matriz es distinta de la Identidad (Rechazar H0, pvalue proximo a Cero) y por lo tanto hay correlación fuera de la diagonal
```{r}
psych::cortest.bartlett(cor1_data,n=dim(df1)[1])

```

##### La estrucura de Asociación solo con datos numéricos es mediana ya que:

1. La matriz de correlación no es tan cercano a 1 las antradas fuera de la diagonal
2. El determinante aunque es pequeño (0.000008), no es cero
3. El indicador KMO, está a la mitad de 1 (KMO=0.53)
4. Se rechaza H0 de la prueba de Bartlett

Por lo tanto, se puede afirmar que tiene una estrutura de asociación Mediana

Se complementó la revisión de la estructura de Asociación con la matriz de correlación Policorica



##### Matriz de Correlación Policórica con el paquete 'polycor'


La correlación policórica requiere que las variables ordinales estén definidas como "ordered factors" en R.

 Identificamos las variables que son ordinales en nuestos datos:
 
- quality_of_sleep (escala numérica, pero representa categorías ordenadas)
- stress_level (escala numérica, pero representa categorías ordenadas)
- bmi_category (tiene un orden lógico: Normal < Sobrepeso < Obeso)



```{r}
df_prepared <- df %>%
  mutate(
    # Convertir las variables a factores ordenados
    quality_of_sleep_ord = factor(Quality.of.Sleep, ordered = TRUE),
    stress_level_ord = factor(Stress.Level, ordered = TRUE),
    # Para 'bmi_category', debemos especificar el orden correcto de los niveles
    bmi_category_ord = factor(BMI.Category, 
                              levels = c("Normal", "Overweight", "Obese"),
                              ordered = TRUE)
  )
```

- Se seleccionan las variables ordinales que creamos y las numéricas relevantes para calcular la matriz de correlación mixta.

```{r}
vars_for_correlation <- df_prepared %>%
  select(
    # Variables Ordinales
    quality_of_sleep_ord,
    stress_level_ord,
    bmi_category_ord,
    
    # Variables Continuas/Numéricas
    Age,
    Sleep.Duration,
    Physical.Activity.Level,
    Heart.Rate,
    Daily.Steps
  )

```


Cálculo de la matriz de correlación heterogénea
Se usó la función hetcor()

```{r}
correlation_matrix <- hetcor(vars_for_correlation)
```

Resultados:

```{r}
print("Matriz de Correlación (Policórica / Poliserial / Pearson):")
print(correlation_matrix$correlations)

```
```{r}
ggcorrplot::ggcorrplot(corr = correlation_matrix$correlations,
                       type = "lower", 
                       show.diag = TRUE,
                       lab = TRUE, 
                       lab_size = 3)
```

Determinante de la Matriz
```{r}
det(correlation_matrix$correlations)
```


Indicador KMO (cercano a 1, relación fuerte entre las variables)

```{r}
psych::KMO(correlation_matrix$correlations)
```

Prueba que la Matriz es distinta de la Identidad (Rechazar H0, pvalue proximo a Cero) y por lo tanto hay correlación fuera de la diagonal
```{r}
psych::cortest.bartlett(correlation_matrix$correlations,n=dim(df1)[1])

```

#### Conclusiones / Recap del EDA

El análisis de correlaciones revela patrones claros en la relación entre el sueño, el estrés, la actividad física y los indicadores de salud:

- Existe una **relación negativa muy fuerte entre la calidad del sueño y el nivel de estrés (-0.92)**, lo que confirma la importancia del descanso adecuado en el bienestar psicológico.
- La **duración del sueño se asocia positivamente con la calidad del sueño (0.89)** y negativamente con el estrés (-0.81), reforzando la idea de que dormir más horas contribuye a reducir la tensión emocional.
- Se observa que **una mejor calidad de sueño se relaciona con una frecuencia cardíaca más baja (-0.66)**, mientras que niveles altos de estrés se vinculan con una frecuencia más elevada (0.67).
- En cuanto a la actividad física, los **pasos diarios muestran una fuerte correlación con el nivel de actividad física (0.77)**, validando su uso como proxy de ejercicio.
- En el ámbito demográfico, **la edad presenta correlación positiva con el IMC (0.47)** y con la calidad del sueño (0.52), pero negativa con el nivel de estrés (-0.52).

En conjunto, estos resultados sugieren que la calidad y duración del sueño, junto con el manejo del estrés, son factores centrales en la salud general, mientras que los pasos diarios constituyen un buen indicador del nivel de actividad física. 
El hallazgo de correlaciones muy altas entre ciertas variables (ej. presión arterial sistólica/diastólica o duración/calidad del sueño) indica la existencia de multicolinealidad, lo que deberá considerarse en los modelos posteriores.


### 4.2 Definir la "receta" de preprocesamiento con tidymodels


```{r}
base_recipe <-
  recipe(Sleep.Disorder ~ ., data = df) %>%
  step_dummy(all_nominal_predictors()) %>%  ###Así trabajarán las categóricas
  step_normalize(all_predictors()) %>%
  step_pca(all_predictors(), id = "pca") %>% 
  prep()
```

### 4.2.1 Modelo de PCA

```{r}
data<-read.csv("C:/Users/andre/OneDrive/Documentos/Diplo-Ccia-Datos-Modulo6-NoSupervisado/Sleep_health_and_lifestyle.csv")


data_forPCA <- data[, !(names(data) %in% c("Blood.Pressure_d2", "Quality.of.Sleep"))]

library(recipes)
base_recipe <- 
  recipe(Sleep.Disorder ~ ., data = data_forPCA) %>%
  step_dummy(all_nominal_predictors()) %>%      # Variables categóricas a dummies
  step_normalize(all_numeric_predictors()) %>%  # Escalar/normalizar y centrar numéricas
  step_pca(all_numeric_predictors(), id = "pca") # PCA sobre las numéricas

# Preparar la receta
base_prep <- prep(base_recipe)
```


#### Extraer información de PCA
```{r}

base_pca <- 
  base_prep %>% 
  tidy(id = "pca")

# Mostrar tabla con la carga de cada componente
print(base_pca)

```

Aqui observamos que los traits que mas contribuyen al PC1 son edad y Gender_Male

#### Graficos de varianza explicada por cada componente

```{r}

base_prep %>% 
  tidy(id = "pca", type = "variance") %>% 
  filter(terms == "percent variance") %>% 
  ggplot(aes(x = component, y = value)) + 
  geom_col(fill = "#B53389") + 
  xlim(c(0, 30)) + 
  labs(x = "PC", y = "% de varianza", title = "Scree plot")

```

 Observamos que son 3 componentes los que aportan mas del 10% de varianza cada uno


```{r}
# Gráfico de % acumulado de varianza explicada
base_prep %>% 
  tidy(id = "pca", type = "variance") %>% 
  filter(terms == "cumulative percent variance") %>% 
  ggplot(aes(x = component, y = value)) + 
  geom_col(fill = "#F25E52") + 
  xlim(c(0, 30)) + 
  labs(x = "PC", y = "% acumulado de varianza", title = "Scree plot acumulado")

```
 El gráfico muestra que se necesitan **8 PC** para explicar >75% de la varianza total.

#### Gráficos de barras horizontales, desplegando la contribución positiva o negativa


```{r}
# de las var a cada uno de los componentes
base_pca %>%
  mutate(terms = tidytext::reorder_within(terms, 
                                          abs(value), 
                                          component)) %>%
  ggplot(aes(abs(value), terms, fill = value > 0)) +
  geom_col() +
  facet_wrap(~component, scales = "free_y") +
  tidytext::scale_y_reordered() +
  scale_fill_manual(values = c("#b6dfe2", "#0A537D")) +
  labs(
    x = "Absolute value of contribution",
    y = NULL, fill = "¿Positive?"
  ) +
    theme(axis.text.y = element_text(size = 4))  # Ajusta el tamaño de letra del eje y
```

```{r}
# Crear una lista de componentes por bloques
componentes_bloques <- split(unique(base_pca$component), ceiling(seq_along(unique(base_pca$component))/10))

# Graficar por bloques
for (bloque in componentes_bloques) {
  base_pca %>%
    filter(component %in% bloque) %>%
    mutate(terms = tidytext::reorder_within(terms, abs(value), component)) %>%
    ggplot(aes(abs(value), terms, fill = value > 0)) +
    geom_col() +
    facet_wrap(~component, scales = "free_y") +
    tidytext::scale_y_reordered() +
    scale_fill_manual(values = c("#b6dfe2", "#0A537D")) +
    labs(x = "Absolute value of contribution", y = NULL, fill = "¿Positive?") +
    theme_minimal(base_size = 10) +
    theme(axis.text.y = element_text(size = 6)) -> p
  print(p)
}
```


En el siguiente gráfico solo mostraremos los 6 primeros componentes principales

```{r}

# Mejorar la visualización reduciendo el número de componentes mostrados
        library(forcats)
base_pca %>%
  filter(component %in% paste0("PC", 1:6)) %>%  #desplegar solo los 6 primeros componentes
  mutate(component = fct_inorder(component)) %>%
  ggplot(aes(value, terms, fill = terms)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~component, nrow = 1) +
  labs(y = NULL)
```
+ Observamos nuevamente que Age es la variable que contribuye mas al PC1 y 
 + **Stress level junto con Heart_rate son los que mas contribuyen al PC2**

De la misma forma podemos explorar la contribución de las traits a los compontentes 3.4.5.6


#### Grafico de puntos coloreando en base a la categoría de Sleep.Disorder


 Extraer PCA


```{r}
pca_scores <- juice(base_prep)
head(pca_scores)  # Visualizamos
pca_scores$Sleep.Disorder <- data$Sleep.Disorder #añadimos la var Sleep.Disorder porque la habiamos eliminado apra hacer el PCA
     #grafica
ggplot(pca_scores, aes(x = PC1, y = PC2, label = Sleep.Disorder)) +
  geom_point(aes(color = Sleep.Disorder), alpha = 0.7, size = 2) +
    labs(color = NULL,
       title = "PCA de variables con Sleep.Disorder") +
  theme_minimal()

###3D
```


```{r}
# Colores para rgl
mycolors <- rainbow(length(unique(pca_scores$Sleep.Disorder)))
pca_scores$color <- mycolors[as.numeric(pca_scores$Sleep.Disorder)]

# Gráfico 3D con rgl
plot3d(
    x = pca_scores$PC1,
    y = pca_scores$PC2,
    z = pca_scores$PC3,
    col = pca_scores$color,
    type = 's',
    radius = 0.1,
    xlab = "PC1",
    ylab = "PC2",
    zlab = "PC3"
)

```
#### Gráfico interactivo 3D con plotly


```{r}
library(plotly)
library(rgl)

g.df1 <- plot_ly(
    pca_scores, 
    x = ~PC1, 
    y = ~PC2, 
    z = ~PC3, 
    color = ~Sleep.Disorder, 
    colors = rainbow(length(unique(pca_scores$Sleep.Disorder)))  # colores automáticos
) %>%
    add_markers() %>%
    layout(scene = list(
        xaxis = list(title = 'PC1'),
        yaxis = list(title = 'PC2'),
        zaxis = list(title = 'PC3')
    ))

g.df1
   # otra forma de hacer el mismo gráfico
  # pero mas complicada :(
```

```{r}
df1 <- pca_scores
    #convertir en caracter los Sleep.Disorder, porque como factores no los reconoce
df1 <- df1 %>%
    mutate(Sleep.Disorder = as.character(Sleep.Disorder))
```


#### Hacemos subsets por categoria de Sleep.Disorder
```{r}

df1$Sleep.Disorder[df1$Sleep.Disorder == "None"] <- "N"
df1$Sleep.Disorder[df1$Sleep.Disorder == "Insomnia"] <- "I"
df1$Sleep.Disorder[df1$Sleep.Disorder == "Sleep Apnea"] <- "A"
df1$Sleep.Disorder <- as.factor(df1$Sleep.Disorder)

table(df1$Sleep.Disorder)
```


```{r}
fig <- plot_ly(df1, x = ~PC1, y = ~PC2, z = ~PC3, color = ~Sleep.Disorder, colors = c('#BF382A', '#0C4B8E', "green"))
fig <- fig %>% add_markers()
fig <- fig %>% layout(scene = list(xaxis = list(title = 'PC1'),
                                   yaxis = list(title = 'PC2'),
                                   zaxis = list(title = 'PC3')))

fig

```

# Aqui voy!!! Falta trabajar mas esta sección
######################### Graficos biplots y demás
### Para ello necesitamos usar esta metodología para el PCA
###PCA



```{r}
pca_fit <- data_forPCA %>%
    select(where(is.numeric)) %>%
    scale() %>%
    prcomp()



```


####  Biplot de variables
```{r}

library(factoextra)
library(ggord)  # solo si quieres usar ggord

fviz_pca_var(pca_fit,
             alpha.var = "contrib",
             col.var = "contrib", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             title = 'Influencia de las variables en PCA1 y PCA2',
             repel = TRUE)
```

####  Distribución de los individuos (coloreados por contribución)

```{r}

fviz_pca_ind(pca_fit,
             col.ind = "contrib", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             title='Distribución de los individuos en PCA1 y PCA2',
             repel = TRUE)
```

####  Biplot general (variables en azul, individuos en gris)

```{r}

fviz_pca_biplot(pca_fit, repel = TRUE,
                title='Biplot',
                col.var = "#2E9FDF",
                col.ind = "#696969")
```

⃣#### Gráfico tipo ggord coloreando individuos por Sleep.Disorder

```{r}

ggord(pca_fit, df1$Sleep.Disorder)
```

```{r}

#  Biplot con colores por Sleep.Disorder y elipses de confianza
fviz_pca_biplot(pca_fit, repel = TRUE,
                col.var = "blue", 
                col.ind = df1$Sleep.Disorder, 
                palette = c("#BF382A", "#0C4B8E", "green"),
                addEllipses = TRUE, 
                ellipse.level = 0.95,
                title = "Biplot PCA con Sleep.Disorder")

```


```{r}
fviz_pca_biplot(pca_fit,
                repel = TRUE,              # Evita que las etiquetas se encimen
                col.var = "#2E9FDF",       # Color de las flechas (variables)
                col.ind = "#696969",       # Color de los puntos (individuos)
                arrowsize = 0.8,           # Tamaño de flechas
                pointsize = 2,             # Tamaño de puntos
                title = "Biplot PCA: Variables y Individuos")
```


### 4.2.2 Modelo de tSNE
### 4.2.3 Modelo de UMAP

```{r}

umap_rec <- recipe(~., data = df) %>%
  update_role(Sleep.Disorder, new_role = "id") %>%
  step_dummy(all_nominal_predictors()) %>%  ###Así trabajarán las categóricas
  step_normalize(all_predictors()) %>%
  step_umap(all_predictors())
```



```{r}
umap_res <- prep(umap_rec)
umap_res

```

```{r}
juice(umap_res) %>%
  ggplot(aes(UMAP1, UMAP2)) +
  geom_point(aes(color = Sleep.Disorder), size = 1.5)+
  labs(color = NULL)

```
##Interpretación

El gráfico UMAP muestra que sí existen patrones latentes en los datos (sobre todo para distinguir a quienes no tienen trastorno), pero la frontera entre insomnio y apnea no es nítida, lo cual refleja la complejidad clínica del problema.


<<<<<<< HEAD
=======
Ahora se deja que UMAP juegue con los hiperparámetros
>>>>>>> 065a25cdf4c875b88bd227a515606311338f9110

```{r}
umap_params = expand.grid(n_neighbors = c(10, 20, 50, 100),min_dist = c(0.1, 0.5, 0.75, 1.1))
```

## Se evaluaron distintas combinaciones de parámetros principales de UMAP:

- n_neighbors (vecinos): controla cuánto peso tienen las relaciones locales vs. globales.

  Valores bajos (10–20): más énfasis en la estructura local → aparecen subgrupos pequeños.

  Valores altos (50–100): se prioriza la estructura global → clusters grandes pero menos definidos.

- min_dist: controla cuán apretados o dispersos se muestran los clusters.

  Valores bajos (0.1–0.5): puntos más compactos → se distinguen mejor subgrupos.

  Valores altos (0.75–1.1): los puntos se dispersan → menor definición de clusters.

```{r}
set.seed(123) 
umaps = lapply(seq(nrow(umap_params)), function(i) {
    emb = umap(
      X = df[,-13], #Aca quitamos la variable respuesta, es decir los Slepp Disorder porque ocupa el lugar 13 en el df
      n_neighbors = umap_params$n_neighbors[i],
      min_dist  = umap_params$min_dist[i])

  return(emb)
})

```

- min_dist bajo (0.1–0.5) + pocos vecinos (10–20):
Se ven varios microgrupos → el cluster de “None” aparece más diferenciado, aunque Insomnia y Apnea se dispersan.

- n_neighbors intermedio (20–50) + min_dist=0.5:
Ofrece el mejor balance: los sujetos “None” (verde) tienden a agruparse en masa, mientras que Insomnia (rojo) y Apnea (azul) se intercalan pero con cierta separación periférica.

- n_neighbors muy alto (100) o min_dist grande (0.75–1.1):
Los clusters se diluyen → la estructura se aplana y los tres grupos se mezclan más, perdiendo capacidad de distinguir patrones.

```{r}
d = rbindlist(lapply(seq(nrow(umap_params)), function(i) {
  data.table(
    x = umaps[[i]][,1],
    y = umaps[[i]][,2],
    n_neighbors = umap_params$n_neighbors[i],
    min_dist = umap_params$min_dist[i],
    group = df$Sleep.Disorder
  )
}))
```

De acuerdo con las visualizaciones:

Configuración óptima para este dataset:

n_neighbors = 20–50

min_dist = 0.5

Justificación:

Mantiene la coherencia global sin perder detalle local.

Permite observar que “None” forma un cluster más cohesivo.

Muestra que Insomnia y Sleep Apnea tienden a superponerse, lo cual es realista clínicamente, pero aún así se logran ver diferencias en la periferia.

```{r}
p<-ggplot(d) +
  geom_scattermore(
    mapping = aes(x = x, y = y,colour=group),
    pointsize = 2
  ) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    legend.position = "none"
  ) +
  facet_wrap(min_dist ~ n_neighbors ,
             labeller = label_both,
             scales = "free") +
  theme_bw() +
  labs(title = "WDBC: UMAP")

p
```

#### Conclusiones UMAP

UMAP confirma que:

Existe un patrón claro en personas sin trastorno (grupo más compacto).

Insomnia y Apnea no tienen una frontera bien definida (se mezclan), lo que refleja la complejidad real del fenómeno.

Ajustar los hiperparámetros es clave para resaltar estas diferencias.

### Falta la conclusion final



















